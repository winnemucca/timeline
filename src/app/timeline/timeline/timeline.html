<div class="timeline-root">
  <div class="timeline-selection">
    <h2>Work Orders</h2>

    <div class="timescale-control">
      <span class="timescale-label">Timescale</span>

      <div class="timescale-select">
        <ng-select
          [items]="['day', 'week', 'month']"
          [formControl]="timescaleControl"
          [clearable]="false"
          [searchable]="false"
        >
          <ng-template ng-label-tmp let-item="item">
            {{ item | titlecase }}
          </ng-template>

          <ng-template ng-option-tmp let-item="item">
            {{ item | titlecase }}
          </ng-template>
        </ng-select>
      </div>
    </div>
  </div>
  <!-- ================= HEADER ================= -->
  <div class="timeline-header">
    <!-- LEFT -->
    <div class="left-header"></div>

    <!-- RIGHT -->
    <div class="right-header">
      <!-- MONTH HEADER -->
      @if (timescale() === 'month') {
        <div class="months-row">
          @for (month of months(); track month.label) {
            <div class="month-cell" [style.width.px]="month.span * pxPerUnit">
              {{ month.label }}
            </div>
          }
        </div>
      } @else {
        <!-- UNIT HEADER -->
        <div class="units-row">
          @for (unit of units(); track unit.getTime()) {
            <div class="unit-cell" [style.width.px]="pxPerUnit">
              {{ scale().label(unit) }}
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- ================= BODY ================= -->
  <div class="timeline-body">
    <!-- LEFT COLUMN -->
    <div class="left-column">
      @for (wc of schedule.workCenters(); track wc.id) {
        <div class="work-center-cell">
          {{ wc.name }}
        </div>
      }
    </div>

    <!-- RIGHT GRID -->
    <div class="right-column">
      <!-- TODAY -->
      @if (todayOffsetPx() !== null) {
        <div class="today-indicator" [style.left.px]="todayOffsetPx()"></div>
      }

      <!-- ROWS -->
      @for (wc of schedule.workCenters(); track wc.id) {
        <div class="timeline-row" [style.height.px]="getRowHeight(wc.id)">
          <!-- GRID -->
          <div class="grid-row">
            @for (unit of units(); track unit.getTime()) {
              <div class="grid-cell" [style.width.px]="pxPerUnit"></div>
            }
          </div>

          <!-- WORK ORDERS -->
          @for (pwo of positionedOrdersFor(wc.id)(); track pwo.order.docId) {
            <div class="work-order-bar" [ngClass]="pwo.order.status" [ngStyle]="getBarStyle(pwo)">
              <span class="order-name">
                {{ pwo.order.name }}
              </span>

              <button
                class="actions-btn"
                (click)="toggleMenu(pwo.order.docId); $event.stopPropagation()"
              >
                â‹®
              </button>

              @if (activeMenuOrderId === pwo.order.docId) {
                <div class="actions-menu">
                  <button (click)="openEditPanel(pwo.order)">Edit</button>
                  <button class="danger" (click)="onDelete(pwo.order)">Delete</button>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- ================= PANEL ================= -->
  @if (panelMode) {
    <app-work-order-panel
      [mode]="panelMode"
      [order]="editingOrder"
      (save)="onPanelSave($event)"
      (cancel)="closePanel()"
    />
  }
</div>
